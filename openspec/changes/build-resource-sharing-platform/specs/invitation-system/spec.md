## ADDED Requirements

### Requirement: 邀请链接生成
系统 SHALL为每个用户生成唯一的邀请链接。

#### Scenario: 用户注册时生成邀请码
- **WHEN** 用户完成注册
- **AND** 系统为用户创建唯一邀请码
- **THEN** 生成邀请链接，格式为 /register?invite=邀请码
- **AND** 邀请码使用UUID生成，确保唯一性
- **AND** 邀请码永久有效（除非用户主动重置）

#### Scenario: 用户查看自己的邀请链接
- **WHEN** 登录用户访问用户中心
- **AND** 点击"邀请好友"标签
- **THEN** 显示个人邀请链接
- **AND** 显示二维码（可选）
- **AND** 显示已邀请人数和奖励积分

#### Scenario: 用户重置邀请码
- **WHEN** 用户点击"重置邀请码"
- **AND** 确认操作
- **THEN** 生成新的邀请码
- **AND** 旧邀请码立即失效
- **AND** 之前生成的邀请链接失效

#### Scenario: 邀请码格式验证
- **WHEN** 系统验证邀请码
- **AND** 邀请码必须是有效的UUID格式
- **THEN** 允许访问
- **AND** 记录邀请关系

#### Scenario: 邀请链接分享
- **WHEN** 用户复制邀请链接
- **AND** 分享给其他人
- **THEN** 链接包含邀请码参数
- **AND** 被邀请者访问时自动携带邀请码

### Requirement: 邀请注册流程
系统 SHALL记录邀请关系并在注册成功后给予奖励。

#### Scenario: 通过邀请链接注册
- **WHEN** 用户访问邀请链接
- **AND** 点击注册按钮
- **THEN** 注册表单自动填充邀请码
- **AND** 提示"通过好友邀请注册"

#### Scenario: 邀请码有效性验证
- **WHEN** 用户提交注册表单
- **AND** 包含邀请码
- **THEN** 系统验证邀请码是否存在且有效
- **AND** 如果无效，提示"邀请码无效"

#### Scenario: 注册成功后建立邀请关系
- **WHEN** 新用户完成注册
- **AND** 注册表单包含有效的邀请码
- **THEN** 系统记录邀请关系
- **AND** 邀请人获得积分奖励（默认10积分）
- **AND** 记录邀请时间和奖励状态

#### Scenario: 重复注册验证
- **WHEN** 同一个邮箱尝试用邀请码注册
- **AND** 邮箱已被注册
- **THEN** 提示"邮箱已被注册"
- **AND** 不建立邀请关系

#### Scenario: 自邀请检测
- **WHEN** 用户使用自己的邀请码注册
- **AND** 系统检测到邀请人ID等于注册用户ID
- **THEN** 拒绝自邀请
- **AND** 提示"不能使用自己的邀请码"

### Requirement: 邀请关系管理
系统 SHALL管理用户之间的邀请关系。

#### Scenario: 查看邀请记录
- **WHEN** 用户查看"我的邀请"
- **THEN** 显示所有邀请记录
- **AND** 包括：被邀请用户名、注册时间、奖励状态
- **AND** 标记成功邀请（已注册）和待邀请（未注册）

#### Scenario: 邀请状态统计
- **WHEN** 用户查看邀请统计
- **AND** 显示：总邀请人数、成功邀请人数、累计奖励积分
- **THEN** 实时统计数据准确

#### Scenario: 管理员查看所有邀请关系
- **WHEN** 管理员访问邀请管理页面
- **THEN** 显示所有邀请关系列表
- **AND** 包括：邀请人、被邀请人、邀请时间、奖励状态
- **AND** 支持按时间、用户筛选

#### Scenario: 重复邀请处理
- **WHEN** 同一个邀请码被多个用户使用
- **AND** 第一个成功注册的用户建立邀请关系
- **THEN** 后续使用该邀请码的用户不建立邀请关系
- **AND** 提示"该邀请码已被使用"

#### Scenario: 邀请关系查询
- **WHEN** 需要查询用户A邀请了哪些用户
- **AND** 根据邀请人ID查询
- **THEN** 返回所有被邀请的用户列表
- **AND** 包括邀请时间、注册状态、奖励状态

### Requirement: 邀请奖励机制
系统 SHALL根据邀请关系给予积分奖励。

#### Scenario: 自动给予邀请奖励
- **WHEN** 被邀请用户注册成功
- **THEN** 系统自动为邀请人添加积分奖励
- **AND** 默认奖励数量可配置（建议10积分）
- **AND** 创建积分交易记录，类型为"邀请奖励"

#### Scenario: 积分奖励规则配置
- **WHEN** 管理员访问积分规则设置
- **AND** 修改邀请奖励积分数值
- **AND** 保存配置
- **THEN** 新邀请注册的用户按新规则奖励
- **AND** 已完成的邀请不受影响

#### Scenario: 奖励发放记录
- **WHEN** 给予邀请奖励时
- **THEN** 记录详细的奖励信息
- **AND** 包括：奖励时间、积分数值、被邀请用户ID、邀请人ID
- **AND** 在交易记录中可查询

#### Scenario: 奖励状态追踪
- **WHEN** 显示邀请记录时
- **AND** 显示每个邀请的奖励状态
- **THEN** 标记：已奖励/未奖励/奖励失败
- **AND** 失败时显示失败原因

#### Scenario: 管理员手动调整奖励
- **WHEN** 管理员在邀请记录中点击"手动奖励"
- **AND** 输入积分数值和备注
- **AND** 确认操作
- **THEN** 为邀请人添加额外积分
- **AND** 记录管理员操作日志

### Requirement: 邀请排行榜
系统 SHALL提供邀请排行榜展示活跃邀请用户。

#### Scenario: 用户查看邀请排行
- **WHEN** 任何用户访问邀请排行榜页面
- **THEN** 显示邀请人数最多的Top100用户
- **AND** 包括：排名、用户名、邀请人数、累计奖励积分
- **AND** 当前用户如有邀请会高亮显示

#### Scenario: 邀请排行榜更新
- **WHEN** 有新用户注册并建立邀请关系
- **AND** 邀请人积分增加
- **THEN** 排行榜实时更新排名
- **AND** 显示最新的邀请数据

#### Scenario: 排行榜筛选
- **WHEN** 用户在邀请排行榜页面
- **AND** 选择时间范围（本周、本月、全部）
- **THEN** 显示该时间段的邀请排行榜
- **AND** 积分统计按时间范围计算

#### Scenario: 排行榜奖励
- **WHEN** 管理员配置排行榜奖励规则
- **AND** 每月/每周统计邀请排行榜
- **THEN** 为Top用户提供额外奖励
- **AND** 记录奖励发放记录

#### Scenario: 邀请统计图表
- **WHEN** 管理员查看邀请统计页面
- **AND** 显示邀请趋势图表
- **THEN** 展示邀请数量、奖励积分随时间的变化
- **AND** 支持按日、按周、按月查看

### Requirement: 邀请防作弊机制
系统 SHALL防范邀请作弊行为。

#### Scenario: 检测虚假注册
- **WHEN** 管理员发现大量来自同一IP的邀请注册
- **AND** 符合虚假注册特征
- **THEN** 可以手动标记为可疑邀请
- **AND** 暂停奖励发放，等待审核

#### Scenario: 禁止批量注册
- **WHEN** 系统检测到短时间内大量注册
- **AND** 使用相同邀请码
- **THEN** 暂停该邀请码的奖励
- **AND** 通知管理员审核

#### Scenario: 邀请关系验证
- **WHEN** 需要验证邀请关系的真实性
- **AND** 检查注册IP、设备指纹等信息
- **THEN** 综合评估邀请关系是否合理
- **AND** 异常邀请可被标记为作弊

#### Scenario: 撤销作弊邀请奖励
- **WHEN** 管理员确认某邀请为作弊行为
- **AND** 点击"撤销奖励"
- **AND** 确认操作
- **THEN** 从邀请人账户扣除对应积分
- **AND** 记录撤销原因和操作人

#### Scenario: 邀请黑名单
- **WHEN** 管理员将某用户加入邀请黑名单
- **THEN** 该用户的邀请不再获得奖励
- **AND** 已邀请的用户记录标记为"已撤销"
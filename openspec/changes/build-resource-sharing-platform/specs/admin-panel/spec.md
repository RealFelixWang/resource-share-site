## ADDED Requirements

### Requirement: 管理员登录
系统 SHALL提供独立的管理员后台登录入口，管理员可以通过专用账号密码进入管理系统。

#### Scenario: 管理员后台登录
- **WHEN** 管理员访问 /admin/login 路径
- **AND** 输入管理员账号和密码
- **AND** 点击登录
- **THEN** 系统验证管理员身份
- **AND** 成功登录后跳转到管理员仪表板
- **AND** 创建管理员会话，标记角色为管理员

#### Scenario: 非管理员无法访问后台
- **WHEN** 普通用户尝试访问 /admin/* 任意路径
- **THEN** 重定向到管理员登录页
- **AND** 显示提示"需要管理员权限"

### Requirement: 管理员仪表板
系统 SHALL为管理员提供系统概览和管理功能入口。

#### Scenario: 查看仪表板
- **WHEN** 管理员成功登录
- **THEN** 显示管理员仪表板
- **AND** 显示关键统计信息：用户总数、资源总数、今日新增、待审核资源数
- **AND** 显示快速操作菜单：用户管理、资源审核、分类管理、积分管理、广告管理

#### Scenario: 统计信息实时更新
- **WHEN** 管理员在仪表板页面
- **THEN** 统计数据实时显示
- **AND** 点击具体数字可跳转到详细页面

#### Scenario: 最近活动日志
- **WHEN** 管理员查看仪表板
- **AND** 显示最近系统活动记录
- **AND** 包括：新用户注册、资源上传、积分交易等

### Requirement: 用户管理
系统 SHALL允许管理员查看和管理所有用户账户。

#### Scenario: 查看用户列表
- **WHEN** 管理员访问用户管理页面
- **THEN** 分页显示所有用户
- **AND** 每行显示：ID、用户名、邮箱、注册时间、积分余额、状态（正常/禁用）
- **AND** 支持搜索用户名或邮箱

#### Scenario: 查看用户详情
- **WHEN** 管理员点击某个用户的"查看"按钮
- **THEN** 显示用户详细信息
- **AND** 包括：基本信息、注册时间、最后登录时间、上传的资源列表、积分交易记录

#### Scenario: 编辑用户信息
- **WHEN** 管理员点击用户的"编辑"按钮
- **AND** 修改用户信息（用户名、邮箱）
- **AND** 点击保存
- **THEN** 更新用户信息
- **AND** 记录管理员修改日志

#### Scenario: 禁用/启用用户
- **WHEN** 管理员点击用户的"禁用"按钮
- **AND** 确认操作
- **THEN** 用户状态更新为"禁用"
- **AND** 被禁用的用户无法登录
- **AND** 记录操作日志

#### Scenario: 删除用户
- **WHEN** 管理员点击用户的"删除"按钮
- **AND** 确认删除操作
- **AND** 检查用户是否有上传的资源
- **THEN** 如果有资源，禁止删除并提示转移资源
- **AND** 如果无资源，确认删除用户
- **AND** 删除后不可恢复

### Requirement: 资源审核
系统 SHALL允许管理员审核用户上传的资源。

#### Scenario: 查看待审核资源
- **WHEN** 管理员访问资源审核页面
- **THEN** 显示所有状态为"待审核"的资源
- **AND** 每条显示：标题、上传者、分类、提交时间
- **AND** 可以按时间排序

#### Scenario: 审核资源详情
- **WHEN** 管理员点击待审核资源的"审核"按钮
- **THEN** 显示资源完整信息
- **AND** 包括：标题、描述、分类、网盘链接、上传者信息

#### Scenario: 通过审核
- **WHEN** 管理员在资源详情页点击"通过审核"
- **AND** 输入审核意见（可选）
- **AND** 确认操作
- **THEN** 资源状态更新为"已发布"
- **AND** 记录审核时间、审核人、审核意见
- **AND** 可以选择是否通知上传者

#### Scenario: 拒绝审核
- **WHEN** 管理员点击"拒绝审核"
- **AND** 必须输入拒绝原因
- **AND** 确认操作
- **THEN** 资源状态更新为"已拒绝"
- **AND** 记录审核信息
- **AND** 通知上传者审核结果和原因

#### Scenario: 批量审核
- **WHEN** 管理员在待审核列表中选择多个资源
- **AND** 选择"批量通过"或"批量拒绝"
- **AND** 确认操作
- **THEN** 批量更新资源状态
- **AND** 记录批量审核日志

### Requirement: 分类管理
系统 SHALL允许管理员创建、编辑和删除资源分类。

#### Scenario: 查看分类层级
- **WHEN** 管理员访问分类管理页面
- **THEN** 以树形结构显示所有分类
- **AND** 每个分类显示：名称、资源数量、排序权重
- **AND** 支持拖拽调整排序

#### Scenario: 创建顶级分类
- **WHEN** 管理员点击"新建顶级分类"
- **AND** 输入分类名称、描述、排序权重、图标
- **AND** 点击保存
- **THEN** 创建新的顶级分类
- **AND** 刷新分类树显示

#### Scenario: 创建子分类
- **WHEN** 管理员在某个分类下点击"添加子分类"
- **AND** 输入子分类信息
- **AND** 自动关联到父分类
- **AND** 保存成功
- **THEN** 分类树展开显示子分类

#### Scenario: 编辑分类
- **WHEN** 管理员点击分类的"编辑"按钮
- **AND** 修改分类信息
- **AND** 保存变更
- **THEN** 更新分类信息
- **AND** 分类树即时更新

#### Scenario: 删除分类
- **WHEN** 管理员点击分类的"删除"按钮
- **AND** 确认删除
- **THEN** 检查该分类下是否有资源
- **AND** 如果有资源，显示提示"该分类下还有资源，无法删除"
- **AND** 如果无资源，删除分类
- **AND** 更新分类树结构

### Requirement: 积分管理
系统 SHALL允许管理员查看和管理用户积分。

#### Scenario: 查看积分统计
- **WHEN** 管理员访问积分管理页面
- **THEN** 显示积分系统概览
- **AND** 包括：总发放积分、总消费积分、当前流通积分、用户平均积分

#### Scenario: 查看用户积分
- **WHEN** 管理员搜索或选择特定用户
- **THEN** 显示该用户的积分余额
- **AND** 显示完整的积分交易记录
- **AND** 可以导出交易记录

#### Scenario: 手动添加积分
- **WHEN** 管理员选择用户并点击"添加积分"
- **AND** 输入积分数值和备注
- **AND** 确认操作
- **THEN** 为用户添加积分
- **AND** 记录管理员操作日志

#### Scenario: 手动扣除积分
- **WHEN** 管理员选择用户并点击"扣除积分"
- **AND** 输入积分数值和原因
- **AND** 确认操作
- **AND** 用户积分充足
- **THEN** 扣除积分
- **AND** 记录管理员操作日志

#### Scenario: 积分规则配置
- **WHEN** 管理员访问积分规则配置
- **AND** 可以设置：注册赠送积分、邀请奖励积分、签到奖励积分、上传奖励积分
- **AND** 修改规则并保存
- **THEN** 新规则立即生效

### Requirement: 系统日志
系统 SHALL记录和管理系统操作日志。

#### Scenario: 查看操作日志
- **WHEN** 管理员访问系统日志页面
- **AND** 显示所有管理员操作记录
- **AND** 包括：操作时间、管理员、操作类型、目标对象、IP地址、结果

#### Scenario: 日志筛选和搜索
- **WHEN** 管理员在日志页面
- **AND** 可以按时间范围、操作类型、管理员筛选
- **AND** 可以搜索特定操作
- **THEN** 显示符合条件的日志记录

#### Scenario: 日志详情查看
- **WHEN** 管理员点击某条日志的"详情"
- **THEN** 显示完整的操作详情
- **AND** 包括操作前后的数据对比（如果有）

### Requirement: 系统设置
系统 SHALL允许管理员配置系统参数。

#### Scenario: 基础设置
- **WHEN** 管理员访问系统设置页面
- **AND** 可以配置：网站名称、描述、联系方式、ICP备案号
- **AND** 修改后保存
- **THEN** 设置立即生效

#### Scenario: 积分设置
- **WHEN** 管理员在积分设置页面
- **AND** 可以配置：注册赠送积分、下载是否需要积分、最低积分价格等
- **AND** 保存设置
- **THEN** 新设置对所有用户生效

#### Scenario: 缓存设置
- **WHEN** 管理员在缓存设置页面
- **AND** 可以启用/禁用Redis缓存
- **AND** 配置缓存过期时间
- **AND** 可以手动清空缓存
- **THEN** 设置立即生效

### Requirement: 权限管理
系统 SHALL允许管理员管理系统权限配置。

#### Scenario: 查看系统权限配置
- **WHEN** 管理员访问权限管理页面
- **THEN** 显示系统所有权限项列表
- **AND** 每项显示：权限名称、描述、当前状态（启用/禁用）、最后修改时间
- **AND** 支持搜索和筛选权限

#### Scenario: 启用普通用户上传权限
- **WHEN** 管理员将"允许普通用户上传"设为启用
- **AND** 保存配置
- **THEN** 普通用户可以访问资源上传页面
- **AND** 记录权限变更日志

#### Scenario: 禁用普通用户上传权限
- **WHEN** 管理员将"允许普通用户上传"设为禁用
- **AND** 保存配置
- **THEN** 普通用户无法访问资源上传页面
- **AND** 已上传的用户资源不受影响

#### Scenario: 配置爬虫规则
- **WHEN** 管理员访问爬虫配置页面
- **AND** 创建或编辑爬虫规则
- **AND** 配置目标站点、选择器、字段映射
- **AND** 保存规则
- **THEN** 规则保存成功，可用于抓取任务

#### Scenario: 管理爬虫任务
- **WHEN** 管理员访问爬虫任务页面
- **THEN** 显示所有爬虫任务列表
- **AND** 包括：任务名称、状态（运行中/已完成/失败）、进度、创建时间
- **AND** 可以启动、停止、删除任务

#### Scenario: 查看导入任务历史
- **WHEN** 管理员访问导入历史页面
- **THEN** 显示所有导入任务记录
- **AND** 包括：类型（Excel/爬虫）、状态、总数、成功数、失败数、时间
- **AND** 可以查看任务详情和错误日志

#### Scenario: 管理用户上传权限
- **WHEN** 管理员在用户管理页面
- **AND** 点击某用户的"权限管理"按钮
- **THEN** 可以单独开启/关闭该用户的上传权限
- **AND** 操作立即生效

### Requirement: Dashboard统计展示
系统 SHALL在管理员后台首页展示关键统计数据。

#### Scenario: 查看访问统计
- **WHEN** 管理员登录Dashboard
- **THEN** 显示访问统计数据
- **AND** 包括：今日访问用户数、本月访问用户数、本季度访问用户数
- **AND** 显示最近7天的访问趋势图表
- **AND** 显示同比增长率（与上月、上季度对比）

#### Scenario: 查看评论统计
- **WHEN** 管理员在Dashboard查看评论统计
- **THEN** 显示评论统计数据
- **AND** 包括：今日评论数、本周评论数、本月评论数
- **AND** 显示最近7天的评论趋势图表
- **AND** 按资源分类显示评论分布

#### Scenario: Dashboard卡片展示
- **WHEN** 管理员查看Dashboard
- **THEN** 以卡片形式展示关键指标
- **AND** 每个卡片显示：标题、数值、变化趋势（上涨/下跌）、百分比
- **AND** 包括：用户总数、资源总数、待审核资源数、待审核评论数

#### Scenario: 统计时间范围切换
- **WHEN** 管理员在Dashboard页面
- **AND** 点击时间范围选择器（今日、本月、本季度）
- **THEN** 切换统计数据显示
- **AND** 图表和数据同步更新
- **AND** 默认显示本月数据

#### Scenario: 统计报表导出
- **WHEN** 管理员点击"导出报表"按钮
- **AND** 选择导出格式（Excel/PDF）
- **AND** 选择时间范围
- **THEN** 生成包含所有统计数据的报表
- **AND** 下载报表文件

### Requirement: 账户管理
系统 SHALL允许管理员禁止和解禁用户账户。

#### Scenario: 禁止用户账户
- **WHEN** 管理员在用户列表选择用户
- **AND** 点击"禁止账户"按钮
- **AND** 输入禁止原因
- **AND** 确认操作
- **THEN** 用户状态更新为"已禁止"
- **AND** 用户无法登录系统
- **AND** 记录禁止操作日志

#### Scenario: 解禁用户账户
- **WHEN** 管理员访问被禁止用户详情
- **AND** 点击"解禁账户"按钮
- **AND** 确认操作
- **THEN** 用户状态更新为"正常"
- **AND** 用户可以正常登录
- **AND** 记录解禁操作日志

#### Scenario: 禁止用户尝试登录
- **WHEN** 被禁止的用户尝试登录
- **AND** 输入正确的用户名和密码
- **THEN** 显示"账户已被禁止，请联系管理员"
- **AND** 不允许登录

#### Scenario: 批量禁止账户
- **WHEN** 管理员在用户列表选择多个用户
- **AND** 点击"批量禁止"按钮
- **AND** 输入禁止原因
- **AND** 确认操作
- **THEN** 所有选中用户状态更新为"已禁止"
- **AND** 记录批量操作日志

#### Scenario: 查看账户禁止历史
- **WHEN** 管理员在用户详情页
- **AND** 查看"账户操作历史"
- **THEN** 显示禁止和解禁记录
- **AND** 包括：操作时间、操作人、操作类型、原因
- **AND** 支持按时间筛选

### Requirement: IP管理
系统 SHALL允许管理员管理IP黑名单。

#### Scenario: 添加IP到黑名单
- **WHEN** 管理员在IP管理页面
- **AND** 点击"添加IP"按钮
- **AND** 输入IP地址
- **AND** 选择禁止类型（临时/永久）
- **AND** 输入禁止原因
- **AND** 确认操作
- **THEN** IP地址添加到黑名单
- **AND** 记录禁止时间、原因、期限

#### Scenario: 移除IP黑名单
- **WHEN** 管理员在IP黑名单列表
- **AND** 选择某条记录
- **AND** 点击"移除"按钮
- **AND** 确认操作
- **THEN** 从黑名单中移除IP
- **AND** 记录移除操作日志

#### Scenario: IP黑名单拦截访问
- **WHEN** 黑名单IP访问网站
- **AND** IP被中间件检测到
- **THEN** 返回403错误页面
- **AND** 提示"IP已被禁止访问"
- **AND** 记录拦截日志

#### Scenario: 批量导入IP黑名单
- **WHEN** 管理员上传包含IP地址的CSV文件
- **AND** 系统解析文件
- **AND** 显示预览列表
- **AND** 确认导入
- **THEN** 所有IP地址添加到黑名单
- **AND** 显示导入结果统计

#### Scenario: 查看IP访问日志
- **WHEN** 管理员在IP管理页面
- **AND** 点击某IP的"查看日志"
- **THEN** 显示该IP的历史访问记录
- **AND** 包括：访问时间、访问页面、IP属地
- **AND** 支持按时间筛选

#### Scenario: IP黑名单自动过期
- **WHEN** 临时禁止的IP超过期限
- **AND** 系统定时检查
- **THEN** 自动从黑名单移除
- **AND** 记录自动过期日志

### Requirement: 评论审核管理
系统 SHALL允许管理员审核和管理用户评论。

#### Scenario: 查看待审核评论
- **WHEN** 管理员访问评论审核页面
- **AND** 默认显示"待审核"状态评论
- **THEN** 分页显示所有待审核评论
- **AND** 每条显示：评论者、资源标题、评论内容预览、提交时间
- **AND** 支持按资源、用户、时间筛选

#### Scenario: 审核单条评论
- **WHEN** 管理员点击某条待审核评论的"审核"按钮
- **THEN** 进入评论详情页面
- **AND** 显示完整评论内容和资源信息
- **AND** 可以选择"通过审核"或"拒绝审核"
- **AND** 可以输入审核意见

#### Scenario: 通过评论审核
- **WHEN** 管理员选择"通过审核"
- **AND** 点击确认
- **THEN** 评论状态更新为"已通过"
- **AND** 记录审核时间和管理员ID
- **AND** 用户可以在前端查看评论

#### Scenario: 拒绝评论审核
- **WHEN** 管理员选择"拒绝审核"
- **AND** 必须输入拒绝原因
- **AND** 确认操作
- **THEN** 评论状态更新为"已拒绝"
- **AND** 记录审核信息
- **AND** 评论不在前端显示

#### Scenario: 批量审核评论
- **WHEN** 管理员在评论列表选择多个评论
- **AND** 点击"批量操作"按钮
- **THEN** 可以选择"批量通过"或"批量拒绝"
- **AND** 批量拒绝需要输入原因
- **AND** 确认后批量更新审核状态

#### Scenario: 查看已审核评论
- **WHEN** 管理员访问评论历史
- **AND** 选择"已通过"或"已拒绝"
- **THEN** 显示对应状态的评论列表
- **AND** 显示审核信息和审核意见
- **AND** 可以撤销或重新审核

#### Scenario: 评论搜索和筛选
- **WHEN** 管理员在评论管理页面
- **AND** 输入搜索条件
- **THEN** 可以按评论内容、用户名、资源标题搜索
- **AND** 可以按状态、时间、用户类型筛选
- **AND** 显示符合条件的评论
## ADDED Requirements

### Requirement: 资源上传权限控制
系统 SHALL确保只有获得管理员授权的用户才能上传资源。

#### Scenario: 普通用户无权限上传
- **WHEN** 普通用户访问资源上传页面
- **AND** 系统权限配置禁止普通用户上传
- **THEN** 隐藏或禁用上传按钮
- **AND** 显示提示"请联系管理员开启上传权限"

#### Scenario: 管理员开启用户上传权限
- **WHEN** 管理员在后台开启某用户的上传权限
- **THEN** 该用户可以访问资源上传页面
- **AND** 上传功能正常工作

#### Scenario: 用户上传权限被禁用
- **WHEN** 管理员禁用用户上传权限
- **AND** 用户尝试访问上传页面
- **THEN** 重定向到权限不足提示页面
- **AND** 无法上传新资源

### Requirement: 资源上传
系统 SHALL允许有权限的用户上传资源信息，包括标题、描述、分类、网盘链接和积分价格。

#### Scenario: 成功上传资源
- **WHEN** 有权限的登录用户访问资源上传页面
- **AND** 填写资源标题、描述、选择分类、输入网盘链接和积分价格
- **AND** 点击发布按钮
- **THEN** 系统保存资源信息
- **AND** 资源状态设为"待审核"或"已发布"（取决于管理员设置）
- **AND** 返回成功提示
- **AND** 跳转到资源详情页

#### Scenario: 必填字段为空
- **WHEN** 用户未填写标题、描述或链接等必填字段
- **AND** 点击发布按钮
- **THEN** 显示错误提示"请填写所有必填字段"
- **AND** 不保存资源信息

#### Scenario: 网盘链接格式验证
- **WHEN** 用户输入网盘链接
- **AND** 链接格式不正确（不是有效的 URL）
- **THEN** 显示错误提示"请输入有效的网盘链接"
- **AND** 不允许提交

#### Scenario: 积分价格为负数
- **WHEN** 用户输入负数积分价格
- **THEN** 显示错误提示"积分价格不能为负数"
- **AND** 将价格设为0或不允许提交

### Requirement: 资源列表展示
系统 SHALL提供分页展示所有已发布的资源，支持按分类筛选和搜索。

#### Scenario: 资源列表页面
- **WHEN** 用户访问首页或资源列表页
- **THEN** 显示分页的资源列表
- **AND** 每条资源显示：标题、描述、分类标签、积分价格、上传者、下载次数、发布时间
- **AND** 显示分页导航

#### Scenario: 按分类筛选
- **WHEN** 用户在分类菜单中选择特定分类
- **THEN** 只显示该分类下的资源
- **AND** URL 更新为分类参数

#### Scenario: 搜索资源
- **WHEN** 用户在搜索框输入关键词
- **AND** 点击搜索或按回车键
- **THEN** 显示标题或描述包含关键词的资源
- **AND** 高亮显示搜索关键词

#### Scenario: 分页浏览
- **WHEN** 资源数量超过每页限制
- **AND** 用户点击页码或"上一页"/"下一页"
- **THEN** 加载对应页的资源
- **AND** 当前页码高亮显示

### Requirement: 资源详情页
系统 SHALL提供资源详情展示，包括描述、下载链接等。

#### Scenario: 查看资源详情
- **WHEN** 用户点击资源列表中的某个资源
- **THEN** 跳转到资源详情页
- **AND** 显示完整的资源信息：标题、描述、分类、积分价格、上传者、下载次数、发布时间、网盘链接

#### Scenario: 免费资源下载
- **WHEN** 用户点击免费资源的下载按钮
- **AND** 用户已登录或有下载权限
- **THEN** 直接跳转到网盘链接
- **AND** 下载次数加1

#### Scenario: 积分资源下载
- **WHEN** 用户点击需要积分的资源的下载按钮
- **AND** 用户积分充足
- **THEN** 扣除相应积分
- **AND** 跳转到网盘链接
- **AND** 下载次数加1

#### Scenario: 积分不足
- **WHEN** 用户尝试下载需要积分的资源
- **AND** 用户积分不足
- **THEN** 显示错误提示"积分不足"
- **AND** 提供获取积分的方法提示

#### Scenario: 未登录用户下载
- **WHEN** 未登录用户点击下载按钮
- **THEN** 重定向到登录页面
- **AND** 登录后返回资源页面

### Requirement: 资源编辑和删除
系统 SHALL允许资源上传者编辑或删除自己上传的资源。

#### Scenario: 编辑自己的资源
- **WHEN** 资源所有者访问资源详情页
- **AND** 点击"编辑"按钮
- **THEN** 进入资源编辑页面
- **AND** 预填充当前资源信息
- **AND** 修改后保存更新

#### Scenario: 删除自己的资源
- **WHEN** 资源所有者点击"删除"按钮
- **AND** 确认删除操作
- **THEN** 从数据库中删除资源
- **AND** 返回资源列表页

#### Scenario: 不能编辑他人资源
- **WHEN** 普通用户尝试编辑他人上传的资源
- **THEN** 不显示编辑按钮
- **AND** 直接访问编辑页面返回403错误

#### Scenario: 管理员可以管理所有资源
- **WHEN** 管理员访问任意资源的详情页
- **THEN** 显示编辑和删除按钮
- **AND** 可以修改或删除任何资源

### Requirement: 资源审核
系统 SHALL支持管理员审核待审核的资源，决定是否发布。

#### Scenario: 管理员审核资源
- **WHEN** 管理员访问管理员后台
- **AND** 查看待审核资源列表
- **AND** 点击资源的"审核"按钮
- **THEN** 进入资源详情审核页面
- **AND** 可以选择"通过"或"拒绝"
- **AND** 输入审核意见（可选）

#### Scenario: 资源审核通过
- **WHEN** 管理员点击"通过"按钮
- **AND** 确认操作
- **THEN** 资源状态更新为"已发布"
- **AND** 记录审核时间和管理员ID
- **AND** 通知资源上传者审核通过

#### Scenario: 资源审核拒绝
- **WHEN** 管理员点击"拒绝"按钮
- **AND** 输入拒绝原因
- **AND** 确认操作
- **THEN** 资源状态更新为"已拒绝"
- **AND** 记录审核时间、拒绝原因和管理员ID
- **AND** 通知资源上传者审核结果

### Requirement: 资源统计
系统 SHALL记录和展示资源的相关统计数据。

#### Scenario: 下载次数统计
- **WHEN** 用户成功下载资源
- **THEN** 资源的下载次数加1
- **AND** 在列表和详情页显示最新下载次数

#### Scenario: 资源浏览量
- **WHEN** 用户访问资源详情页
- **THEN** 浏览次数加1
- **AND** 可在详情页查看浏览次数

#### Scenario: 按热门度排序
- **WHEN** 用户选择"热门"排序
- **AND** 按下载次数降序显示资源
- **AND** 优先展示热门资源

#### Scenario: 按最新发布排序
- **WHEN** 用户选择"最新"排序
- **AND** 按发布时间降序显示资源
- **AND** 最新资源优先展示

### Requirement: 爬虫抓取导入
系统 SHALL支持通过爬虫自动抓取资源信息并导入系统。

#### Scenario: 管理员配置爬虫规则
- **WHEN** 管理员访问爬虫配置页面
- **AND** 设置目标站点URL、抓取规则、字段映射
- **AND** 点击保存配置
- **THEN** 爬虫配置保存成功
- **AND** 可以启动爬虫任务

#### Scenario: 启动爬虫任务
- **WHEN** 管理员点击"开始抓取"按钮
- **AND** 选择已配置的爬虫规则
- **AND** 确认启动
- **THEN** 爬虫开始抓取数据
- **AND** 显示抓取进度
- **AND** 抓取的资源自动进入待审核状态

#### Scenario: 爬虫任务执行
- **WHEN** 爬虫运行时
- **AND** 从目标站点获取资源数据
- **THEN** 解析资源信息（标题、链接、描述等）
- **AND** 将解析的数据保存到数据库
- **AND** 记录抓取日志和统计信息

#### Scenario: 爬虫任务完成
- **WHEN** 爬虫完成抓取任务
- **THEN** 显示抓取统计：成功数量、失败数量、耗时
- **AND** 显示抓取失败的原因（如果有）
- **AND** 可以查看抓取到的资源列表

#### Scenario: 爬虫任务中断
- **WHEN** 爬虫运行时发生错误或被手动停止
- **THEN** 记录中断状态
- **AND** 保存已抓取的数据
- **AND** 管理员可以重新启动任务

### Requirement: Excel 模板导入
系统 SHALL支持通过 Excel 模板批量导入资源。

#### Scenario: 下载 Excel 模板
- **WHEN** 管理员访问资源导入页面
- **AND** 点击"下载模板"按钮
- **THEN** 下载包含示例数据的 Excel 文件
- **AND** 模板包含所有必要字段：标题、描述、分类、网盘链接、积分价格

#### Scenario: 上传 Excel 文件
- **WHEN** 管理员上传填充好的 Excel 文件
- **AND** 点击"导入"按钮
- **THEN** 系统解析 Excel 文件
- **AND** 验证数据格式和必填字段
- **AND** 显示导入预览

#### Scenario: 确认导入
- **WHEN** 管理员查看导入预览
- **AND** 确认数据无误
- **AND** 点击"确认导入"
- **THEN** 系统批量插入资源数据
- **AND** 显示导入进度和结果

#### Scenario: 导入失败处理
- **WHEN** Excel 文件格式错误或数据无效
- **THEN** 显示错误提示
- **AND** 高亮显示有问题的行
- **AND** 提供错误详情和建议

#### Scenario: 导入部分成功
- **WHEN** 部分数据有效，部分数据无效
- **THEN** 只导入有效的数据
- **AND** 生成错误报告，包含失败的行数和原因
- **AND** 提供下载错误报告

### Requirement: 资源来源标识
系统 SHALL标识资源的添加来源。

#### Scenario: 资源来源分类
- **WHEN** 资源被添加
- **AND** 系统记录添加来源
- **THEN** 资源标记来源：管理员手动添加/用户上传/爬虫抓取/Excel导入
- **AND** 在资源详情页显示来源信息

#### Scenario: 按来源筛选资源
- **WHEN** 管理员在资源管理页面
- **AND** 选择"按来源筛选"
- **THEN** 可以按来源查看和管理资源
- **AND** 统计不同来源的资源数量

## ADDED Requirements

### Requirement: 用户注册
系统 SHALL允许用户通过提供有效的用户名、邮箱和密码进行注册，密码需符合安全要求。

#### Scenario: 新用户成功注册
- **WHEN** 用户访问注册页面，填写用户名、邮箱、密码和确认密码
- **AND** 所有信息格式正确且密码强度符合要求
- **THEN** 系统创建新用户账户
- **AND** 向用户邮箱发送验证邮件（可选）
- **AND** 用户收到注册成功消息
- **AND** 自动登录并跳转到首页

#### Scenario: 用户名或邮箱已存在
- **WHEN** 用户尝试注册
- **AND** 用户名或邮箱已被使用
- **THEN** 系统返回错误提示"用户名或邮箱已存在"
- **AND** 注册表单不清空，用户可以修改后重试

#### Scenario: 密码不符合要求
- **WHEN** 用户输入密码
- **AND** 密码长度小于8位或不包含字母和数字
- **THEN** 显示密码强度提示
- **AND** 注册按钮处于禁用状态

### Requirement: 用户登录
系统 SHALL允许已注册用户使用邮箱/用户名和密码登录系统。

#### Scenario: 用户成功登录
- **WHEN** 用户在登录页面输入正确的邮箱/用户名和密码
- **AND** 点击登录按钮
- **THEN** 系统验证用户凭据
- **AND** 创建用户会话
- **AND** 将用户信息存入会话
- **AND** 跳转回首页，显示用户已登录状态

#### Scenario: 密码错误
- **WHEN** 用户输入错误的密码
- **THEN** 系统返回错误提示"用户名或密码错误"
- **AND** 登录失败，不创建会话

#### Scenario: 用户不存在
- **WHEN** 用户输入不存在的邮箱/用户名
- **THEN** 系统返回错误提示"用户名或密码错误"
- **AND** 登录失败，不创建会话

#### Scenario: 记住登录状态
- **WHEN** 用户勾选"记住我"选项
- **AND** 成功登录
- **THEN** 会话有效期延长至7天
- **AND** 下次访问时自动登录

### Requirement: 用户会话管理
系统 SHALL管理用户登录状态，支持会话验证和登出。

#### Scenario: 会话验证中间件
- **WHEN** 用户访问需要登录的页面
- **AND** 会话中存在有效用户信息
- **THEN** 允许访问
- **AND** 在模板中显示用户信息

#### Scenario: 会话过期
- **WHEN** 用户会话过期
- **AND** 用户尝试访问需要登录的页面
- **THEN** 重定向到登录页面
- **AND** 显示提示"登录状态已过期，请重新登录"

#### Scenario: 用户登出
- **WHEN** 用户点击登出按钮
- **THEN** 销毁用户会话
- **AND** 清除登录状态
- **AND** 重定向到首页

### Requirement: 管理员权限
系统 SHALL确保管理员具有特殊权限，可以管理所有用户和系统资源。

#### Scenario: 管理员登录
- **WHEN** 管理员使用管理员账号登录
- **THEN** 在会话中标记用户角色为管理员
- **AND** 可以访问管理员后台页面

#### Scenario: 普通用户不能访问管理员页面
- **WHEN** 普通用户尝试访问管理员页面
- **THEN** 系统返回403错误
- **AND** 显示提示"您没有权限访问此页面"

#### Scenario: 权限验证中间件
- **WHEN** 用户访问管理员页面
- **AND** 用户不是管理员
- **THEN** 请求被拒绝
- **AND** 返回错误页面

### Requirement: 密码安全
系统 SHALL安全存储用户密码，防止明文存储。

#### Scenario: 密码加密存储
- **WHEN** 用户注册或修改密码
- **THEN** 密码使用 bcrypt 或 Argon2 进行哈希加密
- **AND** 数据库中只存储加密后的密码
- **AND** 不存储明文密码

#### Scenario: 密码验证
- **WHEN** 用户登录时输入密码
- **THEN** 系统对比加密后的密码哈希值
- **AND** 验证成功后才允许登录

#### Scenario: 密码修改
- **WHEN** 已登录用户修改密码
- **AND** 输入当前密码和新密码
- **AND** 当前密码正确，新密码符合要求
- **THEN** 更新密码为新密码的哈希值
- **AND** 提示密码修改成功
- **AND** 保持登录状态
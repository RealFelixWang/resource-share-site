## ADDED Requirements

### Requirement: 用户发表评论
系统 SHALL允许登录用户对资源发表评论。

#### Scenario: 登录用户发表评论
- **WHEN** 登录用户访问资源详情页
- **AND** 在评论区域输入评论内容
- **AND** 点击"发表评论"按钮
- **THEN** 评论保存到数据库
- **AND** 评论状态设为"待审核"
- **AND** 显示提示"评论已提交，待管理员审核后显示"

#### Scenario: 评论内容为空
- **WHEN** 用户未输入任何内容就点击"发表评论"
- **THEN** 显示错误提示"评论内容不能为空"
- **AND** 不保存评论

#### Scenario: 评论内容过长
- **WHEN** 用户输入的评论内容超过限制（1000字符）
- **THEN** 限制输入框字符数
- **AND** 提示"评论内容不能超过1000字符"

#### Scenario: 未登录用户无法评论
- **WHEN** 未登录用户尝试访问评论区域
- **THEN** 显示登录提示和链接
- **AND** 隐藏评论输入框

#### Scenario: 评论包含敏感词
- **WHEN** 用户发表的评论包含敏感词汇
- **AND** 系统检测到敏感词
- **THEN** 评论状态设为"已拒绝"
- **AND** 不显示评论
- **AND** 记录审核日志

### Requirement: 评论显示
系统 SHALL仅显示管理员审核通过的评论。

#### Scenario: 显示已审核评论
- **WHEN** 用户访问资源详情页
- **AND** 该资源有已审核通过的评论
- **THEN** 按时间顺序显示评论
- **AND** 每条显示：评论者用户名、评论内容、评论时间
- **AND** 按最新评论在前显示

#### Scenario: 不显示未审核评论
- **WHEN** 用户访问资源详情页
- **AND** 该资源有待审核的评论
- **THEN** 不显示这些未审核的评论
- **AND** 仅显示已通过的评论

#### Scenario: 管理员查看自己的评论
- **WHEN** 管理员查看资源详情页
- **AND** 该资源有管理员自己的评论
- **THEN** 显示所有评论（包括未审核的）
- **AND** 未审核评论标记为"待审核"

#### Scenario: 评论分页
- **WHEN** 资源评论数量超过每页限制（50条）
- **AND** 显示分页导航
- **THEN** 可以浏览不同页的评论

#### Scenario: 无评论时显示
- **WHEN** 资源还没有评论
- **THEN** 显示"暂无评论，快来抢沙发吧！"
- **AND** 鼓励用户发表评论

### Requirement: 评论管理
系统 SHALL允许用户管理自己发表的评论。

#### Scenario: 用户编辑自己的评论
- **WHEN** 用户查看自己发表的评论
- **AND** 点击"编辑"按钮
- **THEN** 进入编辑模式
- **AND** 可以修改评论内容
- **AND** 保存后评论状态重置为"待审核"
- **AND** 需重新审核

#### Scenario: 用户删除自己的评论
- **WHEN** 用户点击自己评论的"删除"按钮
- **AND** 确认删除
- **THEN** 从数据库中删除评论
- **AND** 页面立即移除评论

#### Scenario: 管理员可以管理所有评论
- **WHEN** 管理员访问资源详情页
- **AND** 可以看到所有评论的管理按钮
- **AND** 可以编辑或删除任何评论

#### Scenario: 用户不能编辑他人评论
- **WHEN** 用户尝试访问编辑他人评论的页面
- **THEN** 返回403错误
- **AND** 显示提示"不能编辑他人评论"

### Requirement: 评论审核
系统 SHALL要求管理员审核评论后才能显示。

#### Scenario: 管理员查看待审核评论
- **WHEN** 管理员访问评论审核页面
- **AND** 显示所有待审核评论
- **THEN** 每条显示：评论者、资源标题、评论内容、提交时间
- **AND** 可以按资源、用户、时间筛选

#### Scenario: 管理员审核评论
- **WHEN** 管理员查看某条待审核评论
- **AND** 点击"审核"按钮
- **THEN** 进入评论详情页面
- **AND** 可以选择"通过"或"拒绝"

#### Scenario: 评论审核通过
- **WHEN** 管理员点击"通过"按钮
- **AND** 确认操作
- **THEN** 评论状态更新为"已通过"
- **AND** 记录审核时间和管理员ID
- **AND** 用户可以查看评论

#### Scenario: 评论审核拒绝
- **WHEN** 管理员点击"拒绝"按钮
- **AND** 输入拒绝原因
- **AND** 确认操作
- **THEN** 评论状态更新为"已拒绝"
- **AND** 记录审核时间、拒绝原因和管理员ID
- **AND** 用户不能查看评论

#### Scenario: 管理员查看已审核评论
- **WHEN** 管理员查看评论历史
- **AND** 显示所有已审核的评论
- **THEN** 标记审核结果（通过/拒绝）
- **AND** 可以撤销审核或重新审核

### Requirement: 批量审核评论
系统 SHALL允许管理员批量审核多条评论。

#### Scenario: 管理员选择多条评论
- **WHEN** 管理员在评论列表页面
- **AND** 勾选多条待审核评论
- **THEN** 批量操作按钮变为可用
- **AND** 可以选择"批量通过"或"批量拒绝"

#### Scenario: 批量通过评论
- **WHEN** 管理员选择多条评论
- **AND** 点击"批量通过"按钮
- **AND** 确认操作
- **THEN** 所有选中评论状态更新为"已通过"
- **AND** 记录统一的审核信息
- **AND** 显示成功审核的条数

#### Scenario: 批量拒绝评论
- **WHEN** 管理员选择多条评论
- **AND** 点击"批量拒绝"按钮
- **AND** 输入拒绝原因
- **AND** 确认操作
- **THEN** 所有选中评论状态更新为"已拒绝"
- **AND** 记录统一的拒绝原因
- **AND** 显示成功拒绝的条数

#### Scenario: 批量审核部分成功
- **WHEN** 管理员执行批量操作
- **AND** 部分评论操作成功，部分失败
- **THEN** 显示成功和失败的统计
- **AND** 提供失败原因
- **AND** 成功操作的评论状态已更新

### Requirement: 评论统计
系统 SHALL统计和展示评论数据。

#### Scenario: 资源评论数统计
- **WHEN** 显示资源列表
- **AND** 显示该资源的评论数量
- **THEN** 仅统计已审核通过的评论
- **AND** 在资源卡片显示评论数

#### Scenario: 评论审核统计
- **WHEN** 管理员访问评论统计页面
- **AND** 显示评论数据概览
- **THEN** 包括：总评论数、待审核数、已通过数、已拒绝数
- **AND** 支持按时间范围统计

#### Scenario: 用户评论活跃度
- **WHEN** 管理员查看用户详情
- **AND** 显示用户评论统计
- **THEN** 包括：总评论数、通过率、最后评论时间
- **AND** 可以按用户评论数排序

#### Scenario: 热门资源评论排行
- **WHEN** 管理员查看统计报表
- **AND** 显示评论最多的资源
- **THEN** 按评论数排序显示Top10
- **AND** 包括资源标题和评论数

### Requirement: 评论权限控制
系统 SHALL支持配置评论功能开关。

#### Scenario: 管理员关闭评论功能
- **WHEN** 管理员在系统设置中禁用评论
- **AND** 用户访问资源详情页
- **THEN** 隐藏评论区域
- **AND** 显示提示"评论功能已关闭"

#### Scenario: 管理员开启评论功能
- **WHEN** 管理员重新启用评论
- **AND** 用户访问资源详情页
- **THEN** 显示评论区域
- **AND** 用户可以发表评论

#### Scenario: 限制用户评论频率
- **WHEN** 同一用户在短时间内多次评论
- **AND** 系统配置了评论频率限制（每5分钟最多3条）
- **THEN** 显示频率限制提示
- **AND** 禁止继续发表评论

#### Scenario: 管理员查看评论日志
- **WHEN** 管理员访问操作日志
- **AND** 筛选评论相关操作
- **THEN** 显示所有评论操作记录
- **AND** 包括：创建、编辑、删除、审核等操作
# Project Context

## Purpose
资源分享网站，提供软件、电子资料、电影等多种资源的分享平台。用户可以通过网盘链接分享资源，部分高级资源需要积分获取。具备分类浏览、搜索、积分系统、广告位管理等功能。

## Tech Stack
- **后端语言**: Go 1.25.3
- **Web框架**: 原生 HTTP 或轻量级框架 (如 Gin)
- **数据库**: SQLite (开发) / MySQL 9 (生产) - 使用 GORM
- **缓存**: Redis (可选，需支持禁用)
- **模板引擎**: Go HTML Template
- **前端**: 原生 HTML/CSS/JavaScript + Bootstrap / Tailwind CSS
- **认证**: Session-based 认证
- **文件存储**: 网盘链接管理
- **构建工具**: Go Modules

## Project Conventions

### 代码规范
- 所有注释使用中文
- 使用 gofmt 和 goimports 进行代码格式化
- 遵循 Go 官方代码规范
- 命名采用驼峰命名法
- 包名使用小写单词
- 常量使用全大写加下划线
- 错误处理：使用结构化错误返回，避免 panic

### 架构模式
- **单体架构**: 前端后端不分离，统一 Go 服务
- **MVC 模式**: Model-View-Controller 架构
- **分层架构**: Handler → Service → Repository
- **依赖注入**: 使用构造器注入，避免全局变量
- **配置管理**: 基于环境变量，支持配置热加载
- **中间件模式**: 认证、日志、错误处理等

### 项目结构
```
/cmd
  /server          # 主程序入口
/internal
  /config          # 配置管理
  /handler         # HTTP 处理器
  /service         # 业务逻辑
  /repository      # 数据访问层
  /model           # 数据模型
  /middleware      # 中间件
/pkg
  /utils           # 工具函数
  /errors          # 错误定义
/web
  /templates       # HTML 模板
  /static          # 静态资源 (CSS/JS/图片)
```

### 测试策略
- **单元测试**: 每个 package 提供对应 *_test.go
- **集成测试**: 使用内嵌数据库进行完整流程测试
- **覆盖率要求**: 核心业务逻辑 > 80%
- **基准测试**: 对性能关键路径进行基准测试
- **Mock 测试**: 使用 mockery 生成 mock

### Git 工作流
- **分支策略**: GitFlow
  - main: 主分支，稳定的生产代码
  - develop: 开发分支
  - feature/*: 功能分支
  - hotfix/*: 热修复分支
- **提交规范**: Conventional Commits
  - feat: 新功能
  - fix: 错误修复
  - docs: 文档更新
  - refactor: 重构
  - test: 测试相关
  - chore: 构建过程或辅助工具的变动

## 领域上下文

### 核心实体
1. **用户 (User)**: 注册、登录、个人信息管理
2. **资源 (Resource)**: 标题、描述、分类、网盘链接、积分价格、下载次数
3. **分类 (Category)**: 软件、电子资料、电影等
4. **积分 (Points)**: 用户积分余额、交易记录
5. **广告 (Ad)**: 广告位管理、展示次数
6. **管理员 (Admin)**: 后台管理权限

### 业务规则
- 网盘链接作为资源的主要分享方式
- 默认大部分资源免费，管理员可设置特定资源需要积分
- 积分获取：用户通过邀请新用户注册获得积分奖励
- 积分消费：用户使用积分下载付费资源
- 管理员可控制每个资源的积分价格
- 管理员可管理所有资源、用户、分类和广告
- Dashboard统计：显示每日、每月、每季度的访问用户数和评论数
- 账户管理：管理员可禁止/解禁用户账户
- IP管理：管理员可禁止/解禁特定IP地址
- 响应式设计，支持桌面和移动设备
- 资源占用最小化，Redis 等可禁用
- 资源添加方式：管理员手动添加、爬虫抓取、Excel 模板导入
- 权限控制：默认普通用户无上传权限，需管理员开启权限
- 只有管理员有权限直接添加资源
- 用户可以对资源发表评论
- 评论需经管理员审核后才显示
- 支持批量审核评论

### 数据关系
- 用户与资源：一对多（一个用户可上传多个资源）
- 分类与资源：一对多（一个分类包含多个资源）
- 用户与积分：一对一（每个用户有积分记录）
- 广告与位置：一对多（每个位置可显示多个广告）
- 用户与评论：一对多（一个用户可对多个资源发表评论）
- 资源与评论：一对多（一个资源可有多个评论）
- 用户邀请关系：多对多（一个用户可邀请多个用户，一个用户只能被邀请一次）
- 积分交易记录：用户与积分记录一对多
- 访问记录与用户：一对多（记录访问用户行为，可匿名访问）
- IP黑名单与管理员：多对一（管理员可管理多个IP黑名单）

## 重要约束

### 技术约束
- 单体架构，不使用微服务
- 必须支持 Redis 可选禁用
- 最小化内存和 CPU 占用
- 支持 SQLite/MySQL 双数据库
- 所有接口必须支持移动端
- 禁止使用前端框架（React/Vue/Angular）

### 业务约束
- 资源必须通过网盘链接分享
- 广告位位置固定
- 用户积分不能为负数
- 管理员操作必须审计
- 资源链接需验证有效性

### 性能约束
- 首页加载时间 < 2秒
- 支持并发 100 用户
- MySQL 9 连接池优化
- 静态资源 CDN 优化（可选）

## 外部依赖

### 必需依赖
- **Go 标准库**: net/http, html/template, encoding/json, database/sql
- **GORM**: ORM 框架
- **Gin** (可选): HTTP 框架

### 可选依赖
- **Redis**: 缓存和会话存储（必须支持禁用）
- **Go.uuid**: UUID 生成
- **Go validator**: 数据校验

### 开发依赖
- **Testify**: 测试框架
- ** mockery**: Mock 生成工具
- **Go mock**: Mock 框架
